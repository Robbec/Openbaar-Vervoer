---
title: "User study"
author: "Jeroen O., Niels V.B., Robbe C. & Sebastiano V."
date: "December 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(dplyr)
database <- read.csv("database.csv")
#Verwijder de kolom "id".
database$id = NULL

themeData <- database[database$theme == 1, ]
noThemeData <- database[database$theme == 0, ]

nbUsers <- length(unique(database$user))
themeNbUsers <- length(unique(themeData$user))
noThemeNbUsers <- length(unique(noThemeData$user))

usersFinishedLevel9 <- length(unique(database[database$won == 1 & database$level == 9,]$user))

controlThemegroupByUser <- themeData %>% 
                             group_by(user)
themeGroupByUserMinTimestamp <- themeData %>% 
                             group_by(user) %>% 
                             slice(which.min(timeStamp))
themegroupByUser <- themeData %>% 
                             group_by(user)


noThemeGroupByUserMinTimestamp <- noThemeData %>% 
                             group_by(user) %>% 
                             slice(which.min(timeStamp))
themeNotLevel1LoggedFirst <- themeGroupByUserMinTimestamp[themeGroupByUserMinTimestamp$level != 1, ]
noThemeNotLevel1LoggedFirst <- noThemeGroupByUserMinTimestamp[noThemeGroupByUserMinTimestamp$level != 1, ]


Losses <- database[database$won == 0, ]
Wins <- database[database$won == 1, ]
LossesLevel2 <- Losses[Losses$level == 2, ]
WinsLevel2 <- Wins[Wins$level == 2, ]

FirstWinLevel2 <- aggregate(timeStamp ~ user, WinsLevel2, function(x) min( as.POSIXct(x)))
joinWinAndLossTableLevel2 <- LossesLevel2 %>% inner_join(FirstWinLevel2, by='user')
LossesBeforefirstWinLevel2 <- filter(joinWinAndLossTableLevel2,as.POSIXct(timeStamp.x) < as.POSIXct(timeStamp.y))
nbLossesBeforefirstWinLevel2 <- count(LossesBeforefirstWinLevel2, user)
meanLevel2<- summarise(nbLossesBeforefirstWinLevel2,n = mean(n))
LossesLevel3 <- Losses[Losses$level == 3, ]
WinsLevel3 <- Wins[Wins$level == 3, ]
FirstWinLevel3 <- aggregate(timeStamp ~ user, WinsLevel3, function(x) min( as.POSIXct(x)))
joinWinAndLossTableLevel3 <- LossesLevel3 %>% inner_join(FirstWinLevel3, by='user')
LossesBeforefirstWinLevel3 <- filter(joinWinAndLossTableLevel3,as.POSIXct(timeStamp.x) < as.POSIXct(timeStamp.y))
nbLossesBeforefirstWinLevel3 <- count(LossesBeforefirstWinLevel3, user)

meanLevel3<- summarise(nbLossesBeforefirstWinLevel3,n = mean(n))

```
Nb Of Users: `r nbUsers`

Nb Of Theme Users: `r themeNbUsers`

Nb Of No Theme Users: `r noThemeNbUsers`

Nb Of Switched Users haha: `r themeNbUsers + noThemeNbUsers - nbUsers`

Switched Users: `r unique(themeData$user[themeData$user %in% noThemeData$user])`
```{r}

```

Nb of users lvl 1 not first logged: `r nrow(themeNotLevel1LoggedFirst)`

Users lvl 1 not first logged: `r themeNotLevel1LoggedFirst$user`

Nb of users lvl 1 not first logged: `r nrow(noThemeNotLevel1LoggedFirst)`

Users lvl 1 not first logged: `r noThemeNotLevel1LoggedFirst$user`

Nb Of Entries: `r nrow(database)`

Nb Of Theme Entries: `r nrow(themeData)`

Nb Of No Theme Entries: `r nrow(noThemeData)`

average loss before each Win in level 2: `r meanLevel2$n[[1]]`

average loss before each Win in level 3: `r meanLevel3$n[[1]]`

